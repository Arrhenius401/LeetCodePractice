-- 表：Logs
--
-- +-------------+---------+
-- | Column Name | Type    |
-- +-------------+---------+
-- | id          | int     |
-- | num         | varchar |
-- +-------------+---------+
-- 在 SQL 中，id 是该表的主键。
-- id 是一个自增列。
--
--
-- 找出所有至少连续出现三次的数字。
--
-- 返回的结果表中的数据可以按 任意顺序 排列。

SELECT DISTINCT num AS ConsecutiveNums
FROM (
    SELECT num, (id - ROW_NUMBER() OVER (PARTITION BY num ORDER BY id)) as group_key
    FROM Logs
     ) AS t
GROUP BY num, group_key
HAVING COUNT(*) >= 3;

-- 窗口函数是 SQL 中一种对一组行（称为「窗口」）进行计算，但不会像 GROUP BY 那样将多行聚合为一行的函数
-- 它会为每行数据返回一个计算结果，同时保留原始行的所有列，这是它和普通聚合函数（GROUP BY + SUM/COUNT 等）最核心的区别。

-- 窗口函数基本语法
-- <窗口函数> OVER (
--   [PARTITION BY 分组列]  -- 可选，按指定列分组（类似GROUP BY），窗口仅在组内生效
--   [ORDER BY 排序列]     -- 可选，对组内数据排序（用于累计/排名类计算）
--   [ROWS/RANGE 窗口范围] -- 可选，限定窗口的物理/逻辑范围（如前1行、后3行）
-- )

-- 1. <窗口函数>：可以是两类函数：
--      （1）聚合类：SUM/COUNT/AVG/MAX/MIN（和普通聚合函数同名，但作用逻辑不同）；
--      （2）专用窗口函数：RANK ()/DENSE_RANK ()/ROW_NUMBER ()/NTILE () 等（仅窗口函数可用）。
-- 2. PARTITION BY：分组（「窗口分区」），将数据按指定列拆分成多个独立的窗口（不合并行）；
-- 3. ORDER BY：组内排序，仅对当前分区内的数据排序；
-- 4. ROWS/RANGE：精细控制窗口范围（比如「当前行及前 2 行」「当前行到最后一行」）。

-- 专用窗口函数介绍
-- 1. RANK ()：跳跃排名
--  核心逻辑
--  （1）对分组内排序，相同值获得相同排名；
--  （2）排名会「跳跃」：若有 N 个相同值，下一个排名 = 当前排名 + N。
-- 2. DENSE_RANK ()：连续排名
--  核心逻辑
--  （1）对分组内排序，相同值获得相同排名；
--  （2）排名「不跳跃」：下一个排名 = 当前排名 + 1（无论有多少个相同值）。
-- 3. ROW_NUMBER ()：行号（无并列）
--  核心逻辑
--  （1）对分组内排序，无论值是否相同，都生成唯一、连续的行号；
--  （2）相同值的行号随机分配（若未指定更细的排序规则）。
-- 4. NTILE (N)：分段排名
--  核心逻辑
--  （1）将分组内的数据平均分成 N 个段（桶），为每行分配所属段号；
--  （2）若数据行数无法被 N 整除，前几个段会多 1 行（保证段数 = N）；
--  （3）段号连续且唯一，无并列。